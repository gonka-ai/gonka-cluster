---
# Phase 0: Account Key Setup (Local Machine)
# Extract and validate cluster-specific account keys from local key files

- name: Discover cluster groups
  set_fact:
    cluster_groups: "{{ groups.keys() | select('match', '^cluster[0-9]+$') | list | default(['cluster1']) }}"

- name: Key setup per cluster
  include_tasks: per-cluster.yml
  loop: "{{ cluster_groups }}"
  loop_control:
    loop_var: loop_cluster_name
  vars:
    cluster_name: "{{ loop_cluster_name }}"
